<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master TDH: El Gran Puzzle de 90 Parejas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        body { font-family: 'Inter', sans-serif; }
        .font-cyber { font-family: 'Orbitron', sans-serif; }

        .grid-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 0.75rem;
        }

        .card {
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            min-height: 100px;
            user-select: none;
        }

        .card-active {
            transform: translateY(-4px);
            border-color: #3b82f6;
            background-color: #1e293b;
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.4);
        }

        .card-matched {
            opacity: 0;
            pointer-events: none;
            transform: scale(0.85);
        }

        .card-error {
            animation: shake 0.4s;
            border-color: #ef4444;
            background-color: #451a1a;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-4px); }
            75% { transform: translateX(4px); }
        }

        .level-badge {
            background: linear-gradient(90deg, #1e40af, #3b82f6);
        }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen">

    <div class="max-w-6xl mx-auto px-4 py-6">
        <!-- Cabecera de Estado -->
        <header class="flex flex-col md:flex-row justify-between items-end mb-6 gap-4 border-b border-slate-800 pb-6">
            <div>
                <h1 class="text-3xl font-black font-cyber tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-indigo-400 uppercase">
                    TDH ULTIMATE CHALLENGE
                </h1>
                <p class="text-slate-500 text-[10px] font-bold tracking-[0.3em] uppercase mt-1 italic">90 conceptos extra√≠dos de la misi√≥n</p>
            </div>
            
            <div class="flex gap-3">
                <div class="bg-slate-900 border border-slate-700 px-4 py-2 rounded-xl text-center min-w-[90px]">
                    <span class="text-[9px] block text-slate-500 font-bold uppercase tracking-widest">Score</span>
                    <span id="score" class="text-lg font-cyber font-bold text-blue-400">0000</span>
                </div>
                <div class="bg-slate-900 border border-slate-700 px-4 py-2 rounded-xl text-center min-w-[90px]">
                    <span class="text-[9px] block text-slate-500 font-bold uppercase tracking-widest">Nivel</span>
                    <span id="level-display" class="text-lg font-cyber font-bold text-emerald-400">1 / 3</span>
                </div>
            </div>
        </header>

        <!-- Progreso Detallado -->
        <div class="bg-slate-900/40 border border-slate-800 p-4 rounded-2xl mb-8 flex flex-col md:flex-row items-center gap-6">
            <div class="flex items-center gap-4">
                <div id="level-icon" class="w-12 h-12 bg-blue-600 rounded-2xl flex items-center justify-center text-2xl shadow-lg shadow-blue-900/20">üëÅÔ∏è</div>
                <div>
                    <h2 id="level-title" class="font-black text-white text-lg leading-tight uppercase tracking-tight">Cargando Nivel...</h2>
                    <p id="level-desc" class="text-xs text-slate-400 italic">Completa las 3 oleadas para avanzar.</p>
                </div>
            </div>
            
            <div class="flex-1 w-full">
                <div class="flex justify-between text-[10px] font-bold text-slate-500 mb-2 uppercase tracking-widest">
                    <span>Progreso Global del Nivel</span>
                    <span id="wave-progress">0 / 30</span>
                </div>
                <div class="w-full bg-slate-800 h-3 rounded-full overflow-hidden p-[2px]">
                    <div id="progress-bar" class="bg-gradient-to-r from-blue-600 to-indigo-400 h-full rounded-full transition-all duration-700" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Rejilla de Juego -->
        <div id="puzzle-grid" class="grid-cards min-h-[450px]">
            <!-- Inyectado por JavaScript -->
        </div>

        <!-- Notificaci√≥n de Oleada -->
        <div id="wave-toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 bg-blue-600 text-white px-6 py-3 rounded-full font-black text-xs uppercase tracking-[0.2em] shadow-2xl opacity-0 transition-opacity pointer-events-none z-40">
            ¬°Oleada Completada! Cargando nuevos conceptos...
        </div>

        <!-- Overlays -->
        <div id="overlay" class="fixed inset-0 bg-slate-950/90 backdrop-blur-md flex items-center justify-center z-50 hidden p-6">
            <div class="bg-slate-900 p-8 rounded-3xl border border-slate-700 text-center max-w-sm w-full shadow-2xl">
                <div class="text-5xl mb-4" id="overlay-icon">üöÄ</div>
                <h2 class="text-2xl font-black mb-2 font-cyber uppercase tracking-tight text-white" id="overlay-title">¬°Nivel Superado!</h2>
                <p class="text-slate-400 mb-8 text-sm leading-relaxed" id="overlay-msg">Has demostrado un dominio total de este bloque tecnol√≥gico.</p>
                <button onclick="nextLevel()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-black py-4 rounded-xl transition-all uppercase tracking-widest text-xs shadow-lg shadow-blue-900/40">
                    Siguiente Desaf√≠o
                </button>
            </div>
        </div>

        <div id="final-overlay" class="fixed inset-0 bg-slate-950/95 backdrop-blur-2xl flex items-center justify-center z-50 hidden p-6">
            <div class="text-center max-w-lg">
                <div class="w-24 h-24 bg-emerald-500/20 rounded-full flex items-center justify-center mx-auto mb-6 border border-emerald-500/50">
                    <svg class="w-12 h-12 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke-linecap="round" stroke-linejoin="round" stroke-width="3"></path></svg>
                </div>
                <h2 class="text-5xl font-black mb-2 font-cyber text-white tracking-tighter italic uppercase">CERTIFICADO MASTER TDH</h2>
                <p class="text-blue-400 font-bold mb-8 uppercase tracking-[0.3em] text-xs">Puntuaci√≥n Final de Misi√≥n</p>
                <div class="bg-slate-900 border border-slate-800 p-10 rounded-[3rem] mb-10 shadow-2xl relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-blue-500 to-transparent opacity-50"></div>
                    <div class="text-8xl font-black font-cyber text-white" id="final-score">0000</div>
                </div>
                <button onclick="location.reload()" class="bg-white text-slate-950 px-12 py-5 rounded-2xl font-black uppercase tracking-widest hover:scale-105 transition-all shadow-xl">
                    Reiniciar Sistema
                </button>
            </div>
        </div>
    </div>

    <script>
        const gameLevels = [
            {
                title: "Bloque 1: Cloud & Digitalizaci√≥n",
                icon: "‚òÅÔ∏è",
                desc: "Domina la infraestructura y la gesti√≥n del taller.",
                pairs: [
                    { id: 1, term: "IaaS", match: "Alquiler de hardware/servidores" },
                    { id: 2, term: "PaaS", match: "Plataforma para crear apps" },
                    { id: 3, term: "SaaS", match: "Software listo (Gmail/Netflix)" },
                    { id: 4, term: "La Nube", match: "No es humo, es eficiencia" },
                    { id: 5, term: "Analog√≠a IaaS", match: "Alquilar el local del restaurante" },
                    { id: 6, term: "Analog√≠a PaaS", match: "Tener cocina y fogones listos" },
                    { id: 7, term: "Analog√≠a SaaS", match: "Ir a mesa puesta y comer" },
                    { id: 8, term: "DMS", match: "Software de gesti√≥n de taller" },
                    { id: 9, term: "Papel Carb√≥n", match: "M√©todo obsoleto de Manolo" },
                    { id: 10, term: "Recepci√≥n Activa", match: "Inspecci√≥n digital con Tablet" },
                    { id: 11, term: "Agenda Papel", match: "Riesgo de citas duplicadas" },
                    { id: 12, term: "Facturaci√≥n DMS", match: "Autom√°tica desde la orden" },
                    { id: 13, term: "Recambios Cloud", match: "Stock visible en tiempo real" },
                    { id: 14, term: "Ahorro CAPEX", match: "No comprar servidores caros" },
                    { id: 15, term: "Mantenimiento IT", match: "Lo hace el proveedor de SaaS" },
                    { id: 16, term: "Seguridad Cloud", match: "Backups autom√°ticos seguros" },
                    { id: 17, term: "Escalabilidad", match: "Crecer sin comprar m√°s PCs" },
                    { id: 18, term: "Firma Digital", match: "Validez legal en la Tablet" },
                    { id: 19, term: "Checklist Digital", match: "Fotos de da√±os al recibir" },
                    { id: 20, term: "Historial Cl√≠nico", match: "Vida pasada de cada veh√≠culo" },
                    { id: 21, term: "LOPD", match: "Protecci√≥n de datos del cliente" },
                    { id: 22, term: "SaaS: Ejemplo", match: "Office 365 o Spotify" },
                    { id: 23, term: "Servidor F√≠sico", match: "El plan err√≥neo de Manolo" },
                    { id: 24, term: "Hardware", match: "La parte f√≠sica (hierro)" },
                    { id: 25, term: "Virtualizaci√≥n", match: "Correr software en servidores remotos" },
                    { id: 26, term: "Conectividad", match: "Requisito para trabajar en la nube" },
                    { id: 27, term: "Multi-acceso", match: "Entrar al taller desde casa" },
                    { id: 28, term: "Automatizaci√≥n", match: "Menos errores humanos" },
                    { id: 29, term: "Consultor Junior", match: "Vuestro rol en el proyecto" },
                    { id: 30, term: "Modernizaci√≥n", match: "Objetivo de 'El Pist√≥n'" }
                ]
            },
            {
                title: "Bloque 2: Latencia & Realidades",
                icon: "‚ö°",
                desc: "Velocidad de decisi√≥n y herramientas visuales.",
                pairs: [
                    { id: 31, term: "Latencia", match: "Retraso en milisegundos (ms)" },
                    { id: 32, term: "Edge Computing", match: "Procesar datos en el coche" },
                    { id: 33, term: "Fog Computing", match: "Capa intermedia (antenas)" },
                    { id: 34, term: "Analog√≠a Edge", match: "M√©dula espinal (reflejos)" },
                    { id: 35, term: "Analog√≠a Cloud", match: "Cerebro (decisi√≥n lenta/profunda)" },
                    { id: 36, term: "Frenado AEB", match: "Funci√≥n 100% Edge" },
                    { id: 37, term: "Mapas GPS", match: "Funci√≥n 100% Cloud" },
                    { id: 38, term: "Nodo Fog", match: "Sem√°foro o antena inteligente" },
                    { id: 39, term: "Caso Hielo", match: "Aviso local coche a coche" },
                    { id: 40, term: "V2I", match: "Veh√≠culo a Infraestructura" },
                    { id: 41, term: "Realidad Virtual", match: "Inmersi√≥n digital completa" },
                    { id: 42, term: "Realidad Aumentada", match: "Info digital sobre lo real" },
                    { id: 43, term: "RV: Alto Voltaje", match: "Pr√°ctica sin electrocuci√≥n" },
                    { id: 44, term: "RA: Gafas", match: "Manos libres para el mec√°nico" },
                    { id: 45, term: "Asistencia Remota", match: "Experto gu√≠a por videollamada RA" },
                    { id: 46, term: "Simulador Vuelo", match: "Equivalente a formaci√≥n en RV" },
                    { id: 47, term: "Par de Apriete", match: "Dato RA sobre el tornillo" },
                    { id: 48, term: "Oclusi√≥n", match: "Mundo real tapa al virtual" },
                    { id: 49, term: "Inmersi√≥n", match: "Enga√±ar a los sentidos" },
                    { id: 50, term: "Arco El√©ctrico", match: "Simulaci√≥n de peligro en RV" },
                    { id: 51, term: "Checklist RA", match: "Pasos flotando ante los ojos" },
                    { id: 52, term: "Sensores Coche", match: "Ojos del Edge Computing" },
                    { id: 53, term: "C√°maras/Radar", match: "Fuentes de datos de seguridad" },
                    { id: 54, term: "Mantenimiento RV", match: "Ahorro de motores reales" },
                    { id: 55, term: "Error Seguro", match: "Equivocarse en virtual no mata" },
                    { id: 56, term: "Diagramas RA", match: "Ver cables internos por fuera" },
                    { id: 57, term: "Formaci√≥n 4.0", match: "Aprender haciendo (virtual)" },
                    { id: 58, term: "Big Data", match: "Analizar millones de trayectos" },
                    { id: 59, term: "Coordinaci√≥n Cruce", match: "Uso t√≠pico de Fog Computing" },
                    { id: 60, term: "Tiempo Real", match: "Decisiones en milisegundos" }
                ]
            },
            {
                title: "Bloque 3: 3D, Blockchain & TDH",
                icon: "üîó",
                desc: "Fabricaci√≥n, confianza y trazabilidad total.",
                pairs: [
                    { id: 61, term: "Fab. Aditiva", match: "Impresi√≥n 3D (capa a capa)" },
                    { id: 62, term: "Fab. Sustractiva", match: "Quitar material (torno)" },
                    { id: 63, term: "PLA", match: "Filamento pl√°stico biodegradable" },
                    { id: 64, term: "ABS / ASA", match: "Pl√°sticos resistentes al exterior" },
                    { id: 65, term: "G-Code", match: "Lenguaje de la impresora 3D" },
                    { id: 66, term: "Slicer", match: "Software que lamina la pieza" },
                    { id: 67, term: "√ötiles Propios", match: "Herramientas hechas en el taller" },
                    { id: 68, term: "Pieza Descatalogada", match: "Salvaci√≥n para coches cl√°sicos" },
                    { id: 69, term: "Blockchain", match: "Notario digital inalterable" },
                    { id: 70, term: "Descentralizado", match: "Sin due√±o √∫nico del servidor" },
                    { id: 71, term: "Inalterable", match: "No se puede borrar ni editar" },
                    { id: 72, term: "Pasaporte Digital", match: "Vida completa del coche en red" },
                    { id: 73, term: "Fraude de KM", match: "Imposible con Blockchain" },
                    { id: 74, term: "Hash", match: "Huella digital de cada bloque" },
                    { id: 75, term: "Nodo", match: "Cada PC que guarda la cadena" },
                    { id: 76, term: "Smart Contract", match: "Acuerdo que se paga solo" },
                    { id: 77, term: "Trazabilidad", match: "Ruta de la pieza de cuna a tumba" },
                    { id: 78, term: "Econom√≠a Circular", match: "Saber el estado real de bater√≠as" },
                    { id: 79, term: "Tokenizaci√≥n", match: "Dividir valor en partes digitales" },
                    { id: 80, term: "Criptograf√≠a", match: "Seguridad por matem√°ticas" },
                    { id: 81, term: "TDH", match: "Tecnolog√≠as Habilitadoras" },
                    { id: 82, term: "Catalizadores", match: "Aceleran la transformaci√≥n" },
                    { id: 83, term: "Gemelo Digital", match: "R√©plica virtual interactiva" },
                    { id: 84, term: "STL", match: "Archivo est√°ndar de dise√±o 3D" },
                    { id: 85, term: "Warping", match: "Deformaci√≥n por calor en 3D" },
                    { id: 86, term: "Post-procesado", match: "Lijado y acabado de la pieza" },
                    { id: 87, term: "Filamento", match: "El 'hilo' de la impresora 3D" },
                    { id: 88, term: "Consenso", match: "Acuerdo entre nodos para validar" },
                    { id: 89, term: "Confianza", match: "Lo que Blockchain da al cliente" },
                    { id: 90, term: "Taller del Futuro", match: "Sinergia de todas las TDH" }
                ]
            }
        ];

        let currentLevel = 0;
        let score = 0;
        let matchedInLevel = 0;
        let selectedId = null;
        let selectedType = null;
        let waveIndex = 0;
        const PAIRS_PER_WAVE = 10;

        function initGame() {
            renderLevel();
        }

        function renderLevel() {
            const levelData = gameLevels[currentLevel];
            document.getElementById('level-display').innerText = `${currentLevel + 1} / 3`;
            document.getElementById('level-title').innerText = levelData.title;
            document.getElementById('level-icon').innerText = levelData.icon;
            
            updateUI();
            
            const grid = document.getElementById('puzzle-grid');
            grid.innerHTML = '';

            // Obtener oleada
            const start = waveIndex * PAIRS_PER_WAVE;
            const end = start + PAIRS_PER_WAVE;
            const currentPairs = levelData.pairs.slice(start, end);

            let cards = [];
            currentPairs.forEach(p => {
                cards.push({ id: p.id, text: p.term, type: 'term' });
                cards.push({ id: p.id, text: p.match, type: 'match' });
            });

            cards.sort(() => Math.random() - 0.5);

            cards.forEach(c => {
                const el = document.createElement('div');
                el.className = "card bg-slate-900 border-2 border-slate-800 rounded-2xl p-4 flex items-center justify-center text-center cursor-pointer hover:border-slate-500 shadow-xl";
                el.dataset.id = c.id;
                el.dataset.type = c.type;
                el.innerHTML = `<span class="text-[11px] md:text-xs font-bold leading-tight px-1">${c.text}</span>`;
                el.onclick = () => handleSelect(el);
                grid.appendChild(el);
            });
        }

        function handleSelect(el) {
            if (el.classList.contains('card-matched')) return;

            if (el.classList.contains('card-active')) {
                el.classList.remove('card-active');
                selectedId = null;
                selectedType = null;
                return;
            }

            if (selectedType === el.dataset.type) {
                document.querySelectorAll('.card-active').forEach(c => c.classList.remove('card-active'));
            }

            el.classList.add('card-active');

            if (selectedId === null) {
                selectedId = el.dataset.id;
                selectedType = el.dataset.type;
            } else {
                if (selectedId === el.dataset.id && selectedType !== el.dataset.type) {
                    success();
                } else {
                    fail();
                }
            }
        }

        function success() {
            const active = document.querySelectorAll('.card-active');
            active.forEach(c => {
                c.classList.remove('card-active');
                c.classList.add('card-matched');
                c.classList.add('bg-emerald-500/10');
            });

            score += 100;
            matchedInLevel++;
            updateUI();

            const currentWaveMatches = matchedInLevel % PAIRS_PER_WAVE;
            if (currentWaveMatches === 0 && matchedInLevel > 0) {
                if (matchedInLevel < 30) {
                    showWaveToast();
                    waveIndex++;
                    setTimeout(renderLevel, 1200);
                } else {
                    setTimeout(levelComplete, 800);
                }
            }

            selectedId = null;
            selectedType = null;
        }

        function fail() {
            const active = document.querySelectorAll('.card-active');
            active.forEach(c => {
                c.classList.add('card-error');
                setTimeout(() => {
                    c.classList.remove('card-error');
                    c.classList.remove('card-active');
                }, 400);
            });
            score = Math.max(0, score - 20);
            updateUI();
            selectedId = null;
            selectedType = null;
        }

        function updateUI() {
            document.getElementById('score').innerText = score.toString().padStart(4, '0');
            document.getElementById('wave-progress').innerText = `${matchedInLevel} / 30`;
            document.getElementById('progress-bar').style.width = `${(matchedInLevel/30)*100}%`;
        }

        function showWaveToast() {
            const toast = document.getElementById('wave-toast');
            toast.style.opacity = "1";
            setTimeout(() => toast.style.opacity = "0", 2000);
        }

        function levelComplete() {
            document.getElementById('overlay-title').innerText = `¬°Nivel ${currentLevel + 1} Completado!`;
            document.getElementById('overlay-msg').innerText = gameLevels[currentLevel].desc;
            document.getElementById('overlay').classList.remove('hidden');
        }

        function nextLevel() {
            document.getElementById('overlay').classList.add('hidden');
            currentLevel++;
            if (currentLevel < gameLevels.length) {
                matchedInLevel = 0;
                waveIndex = 0;
                renderLevel();
            } else {
                showFinal();
            }
        }

        function showFinal() {
            document.getElementById('final-score').innerText = score.toString().padStart(4, '0');
            document.getElementById('final-overlay').classList.remove('hidden');
        }

        window.onload = initGame;
    </script>
</body>
</html>
