<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master TDH: El Gran Puzzle</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        body { font-family: 'Inter', sans-serif; }
        .font-cyber { font-family: 'Orbitron', sans-serif; }

        .grid-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 0.75rem;
        }

        .card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            min-height: 90px;
        }

        .card-active {
            transform: translateY(-5px) scale(1.02);
            border-color: #3b82f6;
            background-color: #1e293b;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.4);
        }

        .card-matched {
            opacity: 0;
            pointer-events: none;
            transform: scale(0.8);
        }

        .card-error {
            animation: shake 0.4s;
            border-color: #ef4444;
            background-color: #451a1a;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen">

    <div class="max-w-6xl mx-auto px-4 py-6">
        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-end mb-6 gap-4 border-b border-slate-800 pb-6">
            <div>
                <h1 class="text-4xl font-black font-cyber tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-indigo-400 to-purple-400 uppercase">
                    TDH ULTIMATE PUZZLE
                </h1>
                <p class="text-slate-400 text-xs font-bold tracking-[0.2em] uppercase mt-1">Misi√≥n: 100% Trazabilidad Digital</p>
            </div>
            
            <div class="flex gap-3">
                <div class="bg-slate-900 border border-slate-700 px-4 py-2 rounded-xl text-center min-w-[100px]">
                    <span class="text-[10px] block text-slate-500 font-bold uppercase tracking-widest">Puntos</span>
                    <span id="score" class="text-xl font-cyber font-bold text-blue-400">0000</span>
                </div>
                <div class="bg-slate-900 border border-slate-700 px-4 py-2 rounded-xl text-center min-w-[100px]">
                    <span class="text-[10px] block text-slate-500 font-bold uppercase tracking-widest">Nivel</span>
                    <span id="level-display" class="text-xl font-cyber font-bold text-emerald-400">1 / 3</span>
                </div>
            </div>
        </header>

        <!-- Nivel info y Progreso -->
        <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4 bg-slate-900/50 p-4 rounded-2xl border border-slate-800">
            <div class="flex items-center gap-3">
                <div id="level-icon" class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center font-black">1</div>
                <div>
                    <h2 id="level-title" class="font-bold text-lg text-white leading-none">Cargando...</h2>
                    <p id="level-desc" class="text-xs text-slate-400 mt-1 italic">Prep√°rate para el desaf√≠o t√©cnico.</p>
                </div>
            </div>
            <div class="w-full md:w-64">
                <div class="flex justify-between text-[10px] font-bold text-slate-500 mb-1 uppercase tracking-widest">
                    <span>Progreso del nivel</span>
                    <span id="wave-progress">0/30</span>
                </div>
                <div class="w-full bg-slate-800 h-2 rounded-full overflow-hidden">
                    <div id="progress-bar" class="bg-blue-500 h-full transition-all duration-500" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Puzzle Grid -->
        <div id="puzzle-grid" class="grid-cards">
            <!-- Inyectado por JS -->
        </div>

        <!-- Overlay Nivel Completado -->
        <div id="overlay" class="fixed inset-0 bg-slate-950/90 backdrop-blur-md flex items-center justify-center z-50 hidden p-4">
            <div class="bg-slate-900 p-8 rounded-3xl border border-slate-700 text-center max-w-sm w-full shadow-2xl">
                <div class="text-6xl mb-6">‚öôÔ∏è</div>
                <h2 class="text-2xl font-black mb-2 font-cyber uppercase tracking-tight" id="overlay-level-name">¬°Nivel 1 Superado!</h2>
                <p class="text-slate-400 mb-8 text-sm">Has demostrado un dominio excepcional de las herramientas digitales.</p>
                <button onclick="nextLevel()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-black py-4 rounded-2xl transition-all uppercase tracking-widest text-xs shadow-lg shadow-blue-900/40">
                    Siguiente Fase
                </button>
            </div>
        </div>

        <!-- Pantalla Final -->
        <div id="final-overlay" class="fixed inset-0 bg-slate-950/98 backdrop-blur-xl flex items-center justify-center z-50 hidden p-4">
            <div class="text-center max-w-lg">
                <div class="inline-block p-4 bg-emerald-500/20 rounded-full mb-6">
                    <svg class="w-16 h-16 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path></svg>
                </div>
                <h2 class="text-5xl font-black mb-2 font-cyber text-white tracking-tighter italic">CERTIFICADO TDH</h2>
                <p class="text-emerald-400 font-bold mb-8 uppercase tracking-widest text-sm">Nivel: Consultor Experto 4.0</p>
                <div class="bg-slate-900 border border-slate-800 p-8 rounded-3xl mb-10 shadow-inner">
                    <p class="text-slate-500 text-xs uppercase font-black mb-2">Puntuaci√≥n de Misi√≥n</p>
                    <div class="text-7xl font-black font-cyber text-white" id="final-score">0000</div>
                </div>
                <button onclick="location.reload()" class="bg-white text-slate-950 px-12 py-5 rounded-2xl font-black uppercase tracking-widest hover:scale-105 transition-transform shadow-xl">
                    Reiniciar Sistema
                </button>
            </div>
        </div>
    </div>

    <script>
        const gameLevels = [
            {
                title: "Inmersi√≥n y Realidad (RA/RV)",
                icon: "üëÅÔ∏è",
                pairs: [
                    { id: 1, term: "Realidad Virtual", match: "Inmersi√≥n 100% digital" },
                    { id: 2, term: "Realidad Aumentada", match: "Capa digital sobre mundo real" },
                    { id: 3, term: "RV: Alto Voltaje", match: "Entrenamiento sin riesgo el√©ctrico" },
                    { id: 4, term: "RA: HoloLens", match: "Dispositivo manos libres" },
                    { id: 5, term: "RA: Soporte Remoto", match: "Experto gu√≠a a distancia" },
                    { id: 6, term: "RV: Gafas Opacas", match: "Aislamiento total del taller" },
                    { id: 7, term: "RA: Tablet/M√≥vil", match: "Visualizaci√≥n RA accesible" },
                    { id: 8, term: "RV: Simulador", match: "Entrenamiento por repetici√≥n" },
                    { id: 9, term: "RA: Par de Apriete", match: "Dato visual sobre el tornillo" },
                    { id: 10, term: "RV: Arco El√©ctrico", match: "Consecuencia visual de un error" },
                    { id: 11, term: "RA: Diagrama Pins", match: "Esquema sobre conector real" },
                    { id: 12, term: "RV: Prevenci√≥n", match: "Ahorro en accidentes laborales" },
                    { id: 13, term: "RA: Oclusi√≥n", match: "Objeto real tapa al virtual" },
                    { id: 14, term: "TDH", match: "Catalizadores digitales" },
                    { id: 15, term: "RV: Formaci√≥n", match: "Cero desgaste de piezas reales" },
                    { id: 16, term: "RA: Manual Vivo", match: "Instrucciones que flotan" },
                    { id: 17, term: "Inmersi√≥n", match: "Sensaci√≥n de estar dentro" },
                    { id: 18, term: "Asistencia RA", match: "Dibujar sobre vista del t√©cnico" },
                    { id: 19, term: "RV: Bater√≠as", match: "Pr√°ctica de seguridad cr√≠tica" },
                    { id: 20, term: "RA: Eficiencia", match: "Consultar datos sin soltar llave" },
                    { id: 21, term: "RV: Escenario", match: "Entorno 3D generado por PC" },
                    { id: 22, term: "RA: Identificaci√≥n", match: "Reconocer piezas con la c√°mara" },
                    { id: 23, term: "RV: H√°ptica", match: "Sentir tacto con guantes" },
                    { id: 24, term: "RA: Marcadores", match: "Im√°genes que activan la info" },
                    { id: 25, term: "RV: Costes", match: "Menor inversi√≥n en componentes" },
                    { id: 26, term: "RA: Superposici√≥n", match: "A√±adir gr√°ficos a la realidad" },
                    { id: 27, term: "RV: Psicolog√≠a", match: "Reduce el estr√©s ante riesgos" },
                    { id: 28, term: "RA: Tiempo Real", match: "Datos que cambian al instante" },
                    { id: 29, term: "RV: Virtualizaci√≥n", match: "Copia digital del entorno" },
                    { id: 30, term: "RA: Navegaci√≥n", match: "Gu√≠a paso a paso visual" }
                ]
            },
            {
                title: "Fabricaci√≥n y Prototipos (3D)",
                icon: "üñ®Ô∏è",
                pairs: [
                    { id: 31, term: "Aditiva", match: "Fabricaci√≥n capa a capa" },
                    { id: 32, term: "Sustractiva", match: "Quitar material (fresadora)" },
                    { id: 33, term: "PLA", match: "Pl√°stico biodegradable com√∫n" },
                    { id: 34, term: "ABS/ASA", match: "Resistentes al calor y UV" },
                    { id: 35, term: "Slicer", match: "Software laminador" },
                    { id: 36, term: "G-Code", match: "Instrucciones para la m√°quina" },
                    { id: 37, term: "STL", match: "Formato de archivo 3D est√°ndar" },
                    { id: 38, term: "Prototipado", match: "Piezas de prueba r√°pidas" },
                    { id: 39, term: "Descatalogados", match: "Piezas para coches cl√°sicos" },
                    { id: 40, term: "√ötiles a medida", match: "Herramientas de dise√±o propio" },
                    { id: 41, term: "Warping", match: "Deformaci√≥n por fr√≠o/calor" },
                    { id: 42, term: "Post-procesado", match: "Lijado y pintado final" },
                    { id: 43, term: "Filamento", match: "Hilo de material para imprimir" },
                    { id: 44, term: "Boquilla", match: "Punta por donde sale el material" },
                    { id: 45, term: "Bajo demanda", match: "Fabricar solo lo necesario" },
                    { id: 46, term: "Almac√©n Digital", match: "Planos en la nube, no cajas" },
                    { id: 47, term: "Fibra Carbono", match: "Filamento de alta resistencia" },
                    { id: 48, term: "Residuos", match: "Ahorro ecol√≥gico de material" },
                    { id: 49, term: "Escaneo 3D", match: "Copiar pieza real a digital" },
                    { id: 50, term: "Log√≠stica", match: "Evita transporte de recambios" },
                    { id: 51, term: "Extrusor", match: "Empuja el hilo hacia la punta" },
                    { id: 52, term: "Cama Caliente", match: "Base donde se pega la pieza" },
                    { id: 53, term: "Relleno (Infill)", match: "Densidad interna de la pieza" },
                    { id: 54, term: "Soportes", match: "Estructuras para partes al aire" },
                    { id: 55, term: "Capas", match: "Niveles de altura de impresi√≥n" },
                    { id: 56, term: "Nylon", match: "Material flexible y duro" },
                    { id: 57, term: "Resina", match: "L√≠quido para alta precisi√≥n" },
                    { id: 58, term: "Tolerancia", match: "Margen de error en medidas" },
                    { id: 59, term: "CAD", match: "Software de dise√±o original" },
                    { id: 60, term: "Malla 3D", match: "Red de puntos del dise√±o" }
                ]
            },
            {
                title: "Confianza y Datos (Blockchain)",
                icon: "üîó",
                pairs: [
                    { id: 61, term: "Blockchain", match: "Notario digital distribuido" },
                    { id: 62, term: "Inalterable", match: "No se puede borrar ni editar" },
                    { id: 63, term: "Descentralizado", match: "Sin un due√±o √∫nico de los datos" },
                    { id: 64, term: "Pasaporte Digital", match: "Historial de vida del veh√≠culo" },
                    { id: 65, term: "Hash", match: "Firma digital de cada bloque" },
                    { id: 66, term: "Nodo", match: "Cada ordenador de la red" },
                    { id: 67, term: "Smart Contract", match: "C√≥digo que autoejecuta pagos" },
                    { id: 68, term: "Fraude KM", match: "Imposible con Blockchain" },
                    { id: 69, term: "Trazabilidad", match: "Ruta de la pieza de cuna a tumba" },
                    { id: 70, term: "Transparencia", match: "Datos visibles y verificables" },
                    { id: 71, term: "Econom√≠a Circular", match: "Saber el SoH de bater√≠as usadas" },
                    { id: 72, term: "Tokenizaci√≥n", match: "Digitalizar valor de activos" },
                    { id: 73, term: "Criptograf√≠a", match: "Seguridad mediante matem√°ticas" },
                    { id: 74, term: "Consenso", match: "Acuerdo entre nodos para validar" },
                    { id: 75, term: "Privacidad", match: "Datos an√≥nimos pero seguros" },
                    { id: 76, term: "Gemelo Digital", match: "Simulaci√≥n unida a datos reales" },
                    { id: 77, term: "QR T√©cnico", match: "Acceso al historial en Blockchain" },
                    { id: 78, term: "Garant√≠as", match: "Fechas imposibles de manipular" },
                    { id: 79, term: "Sinergia", match: "Combinar RA + 3D + Blockchain" },
                    { id: 80, term: "ITV Digital", match: "Registro oficial inalterable" },
                    { id: 81, term: "Mantenimiento", match: "Libro de revisiones blindado" },
                    { id: 82, term: "Cadena Bloques", match: "Estructura de datos enlazados" },
                    { id: 83, term: "Segunda Mano", match: "Compra segura con datos reales" },
                    { id: 84, term: "Derechos Autor", match: "Pago a fabricante por dise√±o 3D" },
                    { id: 85, term: "Validaci√≥n", match: "Comprobar que el dato es real" },
                    { id: 86, term: "Distribuci√≥n", match: "Copias del libro en mil sitios" },
                    { id: 87, term: "Seguridad 4.0", match: "Protecci√≥n contra hackeos" },
                    { id: 88, term: "Huella Carbono", match: "Rastreo de emisiones reales" },
                    { id: 89, term: "Originalidad", match: "Certificar pieza no falsa" },
                    { id: 90, term: "Futuro Taller", match: "Confianza total del cliente" }
                ]
            }
        ];

        let currentLevel = 0;
        let score = 0;
        let matchedInLevel = 0;
        let selectedId = null;
        let selectedType = null;
        let waveIndex = 0;
        const PAIRS_PER_WAVE = 10;

        function initGame() {
            renderLevel();
        }

        function renderLevel() {
            const levelData = gameLevels[currentLevel];
            document.getElementById('level-display').innerText = `${currentLevel + 1} / 3`;
            document.getElementById('level-title').innerText = levelData.title;
            document.getElementById('level-icon').innerText = levelData.icon;
            document.getElementById('wave-progress').innerText = `${matchedInLevel}/30`;
            document.getElementById('progress-bar').style.width = `${(matchedInLevel/30)*100}%`;
            
            const grid = document.getElementById('puzzle-grid');
            grid.innerHTML = '';

            // Obtener 10 parejas de la oleada actual
            const start = waveIndex * PAIRS_PER_WAVE;
            const end = start + PAIRS_PER_WAVE;
            const currentPairs = levelData.pairs.slice(start, end);

            let cards = [];
            currentPairs.forEach(p => {
                cards.push({ id: p.id, text: p.term, type: 'term' });
                cards.push({ id: p.id, text: p.match, type: 'match' });
            });

            // Mezclar
            cards.sort(() => Math.random() - 0.5);

            cards.forEach(c => {
                const el = document.createElement('div');
                el.className = "card bg-slate-900 border-2 border-slate-800 rounded-xl p-3 flex items-center justify-center text-center cursor-pointer hover:border-slate-600 shadow-lg";
                el.dataset.id = c.id;
                el.dataset.type = c.type;
                el.innerHTML = `<span class="text-xs font-bold leading-tight">${c.text}</span>`;
                el.onclick = () => handleSelect(el);
                grid.appendChild(el);
            });
        }

        function handleSelect(el) {
            if (el.classList.contains('card-matched')) return;

            // Si clica la misma, deseleccionar
            if (el.classList.contains('card-active')) {
                el.classList.remove('card-active');
                selectedId = null;
                selectedType = null;
                return;
            }

            // Deseleccionar anterior si es del mismo tipo
            if (selectedType === el.dataset.type) {
                document.querySelectorAll('.card-active').forEach(c => c.classList.remove('card-active'));
            }

            el.classList.add('card-active');

            if (selectedId === null) {
                selectedId = el.dataset.id;
                selectedType = el.dataset.type;
            } else {
                if (selectedId === el.dataset.id && selectedType !== el.dataset.type) {
                    success();
                } else {
                    fail();
                }
            }
        }

        function success() {
            const active = document.querySelectorAll('.card-active');
            active.forEach(c => {
                c.classList.remove('card-active');
                c.classList.add('card-matched');
                c.classList.add('bg-emerald-500/10');
            });

            score += 100;
            matchedInLevel++;
            updateUI();

            // ¬øOleada terminada?
            const currentWaveMatches = matchedInLevel % PAIRS_PER_WAVE;
            if (currentWaveMatches === 0 && matchedInLevel > 0) {
                if (matchedInLevel < 30) {
                    waveIndex++;
                    setTimeout(renderLevel, 600);
                } else {
                    setTimeout(levelComplete, 600);
                }
            }

            selectedId = null;
            selectedType = null;
        }

        function fail() {
            const active = document.querySelectorAll('.card-active');
            active.forEach(c => {
                c.classList.add('card-error');
                setTimeout(() => {
                    c.classList.remove('card-error');
                    c.classList.remove('card-active');
                }, 400);
            });
            score = Math.max(0, score - 20);
            updateUI();
            selectedId = null;
            selectedType = null;
        }

        function updateUI() {
            document.getElementById('score').innerText = score.toString().padStart(4, '0');
            document.getElementById('wave-progress').innerText = `${matchedInLevel}/30`;
            document.getElementById('progress-bar').style.width = `${(matchedInLevel/30)*100}%`;
        }

        function levelComplete() {
            document.getElementById('overlay-level-name').innerText = `¬°${gameLevels[currentLevel].title} dominado!`;
            document.getElementById('overlay').classList.remove('hidden');
        }

        function nextLevel() {
            document.getElementById('overlay').classList.add('hidden');
            currentLevel++;
            if (currentLevel < gameLevels.length) {
                matchedInLevel = 0;
                waveIndex = 0;
                renderLevel();
            } else {
                showFinal();
            }
        }

        function showFinal() {
            document.getElementById('final-score').innerText = score.toString().padStart(4, '0');
            document.getElementById('final-overlay').classList.remove('hidden');
        }

        window.onload = initGame;
    </script>
</body>
</html>
